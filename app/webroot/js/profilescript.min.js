function disable(){user_id!==visitor_id?($("#changeAvatar").hide(),$("#new-tweetbox").hide(),$("#me").removeClass("active")):$("#me").addClass("active")}function getuserdata(){$.ajax({type:"POST",url:BASE_URL+"user_details/getProfile/",data:{id:visitor_id}}).done(function(e){console.log(e),"SUCCESS"===e.status?($profile=e.data.UserDetail,$("#prof-fullname > b").text($profile.fullname),$("#prof-fullname").attr("href",BASE_URL+$profile.username),$("#prof-username").html("@"+$profile.username),$("#prof-bio > i").html($profile.bio),$("#prof-tweets-count").text($profile.no_of_tweets),$("#prof-following-count").text($profile.no_of_following),$("#prof-followers-count").text($profile.no_of_followers),$profilepic="<img src='"+imgURL($profile.username)+"' class='img-circle'><br>",user_id!==visitor_id&&(console.log("visitor_id"+visitor_id),$.ajax({type:"GET",url:BASE_URL+"connections/checkFollowingStatus",data:{id:visitor_id}}).done(function(e){console.log(e),console.log("SUCCESS"===e.status),"SUCCESS"===e.status?($Followbtn="<button class='btn btn-primary followbtn' id='profileUser"+visitor_id+"' style='width: 50%;margin: 10px auto;'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button>",$("#prof-bio").append($Followbtn),console.log(typeof e.data[0][0].isFollowing),"1"===e.data[0][0].isFollowing?($("#profileUser"+visitor_id).children("#following-text").addClass("active"),$("#profileUser"+visitor_id).children("#following-text").css("display","block")):($("#profileUser"+visitor_id).children("#follow-text").addClass("active"),$("#profileUser"+visitor_id).children("#follow-text").css("display","block"),$("#profileUser"+visitor_id).removeClass("btn-primary"),$("#profileUser"+visitor_id).addClass("btn-default"),$("#profileUser"+visitor_id).children("#follow-text").addClass("btntext-display"))):console.log(e.message)})),$("#changeAvatar").before($profilepic),userprofile=$profile,$profile.resetpassword&&($("#resetPasswordModal").modal({backdrop:"static",keyboard:!1}),$("#resetPasswordModal").modal({show:!0}))):console.log(e.message)})}function imgURL(e){var t=BASE_URL+"img/upload/"+e+".jpg";return t}function validateImg(e){var t=e.name.split(".").pop().toLowerCase();return-1===$.inArray(t,["gif","png","jpg","jpeg"])?1:($file_size=e.size/1048576,$file_size>5?2:!0)}function loadTweets(e,t){$.ajax({type:"POST",url:BASE_URL+"tweet_details/retrievetweets",data:{id:visitor_id,start:start,count:count,display:e,type:t}}).done(function(t){if($("#progress").html(""),"FAILURE"===t.status)$("#tweet-wall").append(t.message);else{if(console.log(t.data.length),t.data.length<25&&t.data.length>0&&(flag=!1),t.data.length>0){var l="";console.log(t),$.each(t.data,function(e,t){var o=t.UD["Tweeter/Retweeter"],s=t.UD.username,a=t.T.id,i=t.T.tweet_text,n=t.T.retweetcount,r=t.T.likecount,d=new Date(t.TD.TweetTime),c=t.TD.RStatus,f=t[0]["Orginator name"],u=t[0]["Orginator username"],g=parseInt(t[0].likestatus);if(0===g)var p='<li class="actions"><button type="button" data-toggle="tooltip" title="Like" class="actionButton likestatus'+a+'"><i class="glyphicon glyphicon-thumbs-up" id="liketweet"></i></button>';else var p='<li class="actions"><button type="button" data-toggle="tooltip" title="Unlike" class="actionButton likestatus'+a+'"><i class="glyphicon glyphicon-thumbs-down" id="unliketweet"></i></button>';if(c){var w=t.TD.tweetorgid,m=t.TD.retweetorgid;l=l+'<div class="media tweetbox" id="'+a+'" style="background : aliceblue"><a class="pull-left" href="'+BASE_URL+u+'"><img class="media-object tweet-thumb" src='+imgURL(u)+' alt="'+f+'">  </a><div class="media-body"> <label class="'+a+'tweeterRetweeter">Retweeted by '+o+'</label>   <h5 class="media-heading"><a href="'+BASE_URL+u+'" alt="'+f+'" class="'+a+'orgname">'+f+'</a><small class="'+a+'orgusername"> @'+u+'</small></h5>  <text class="'+a+'tweettxt">'+i+'</text><div class="tweetactions" dataorgid="'+m+'"datastatus="'+c+'" dataname="'+w+'">     <ul class="pull-right">       <li class="tweettime"><i class="glyphicon glyphicon-time" data-toggle="tooltip" title="'+d+'"></i></li> '+p+'       <span class="likecount '+a+'like" >'+r+'</span></li>        <li class="actions" ><button type="button" data-toggle="tooltip" title="Retweet" class="actionButton"><i class="glyphicon glyphicon-share-alt" id="retweet"></i></button><span class="retweetcount '+a+'tweet">'+n+"</span></li>      </ul>    </div>  </div></div>"}else{var m=t.TD.tweetorgid;l=l+'<div class="media tweetbox" id="'+a+'" style="background : aliceblue"><a class="pull-left" href="'+BASE_URL+s+'"><img class="media-object tweet-thumb" src='+imgURL(s)+' alt="'+o+'">  </a><div class="media-body">    <h5 class="media-heading"><a href="'+BASE_URL+s+'" alt="'+o+'" class="'+a+'orgname">'+o+'</a><small class="'+a+'orgusername"> @'+s+'</small></h5>  <text class="'+a+'tweettxt">'+i+'</text><div class="tweetactions" dataorgid="'+m+'" datastatus="'+c+'" >     <ul class="pull-right">       <li class="tweettime"><i class="glyphicon glyphicon-time" data-toggle="tooltip" title="'+d+'"></i></li> '+p+'       <span class="likecount '+a+'like">'+r+'</span></li>        <li class="actions" ><button type="button" data-toggle="tooltip" title="Retweet" class="actionButton" ><i class="glyphicon glyphicon-share-alt" id="retweet"></i></button><span class="retweetcount '+a+'tweet">'+n+"</span></li>      </ul>    </div>  </div></div>"}}),start+=t.data.length,"top"!==e?$("#tweet-wall").append(l):($(".pollresult").fadeOut("slow"),$(".pollresult").siblings().first().before(l).fadeIn("slow"))}else flag!==!1&&($msg="<p align='center' id='emptymsg'> No tweets to display </p>",$("#tweet-wall").append($msg));console.log("start: "+start)}})}function getFollowers(){$.ajax({type:"POST",url:BASE_URL+"connections/fetchusers/",data:{id:visitor_id,option:0}}).done(function(e){$("#followers-progress").html(""),"SUCCESS"===e.status?(console.log(e),e.data.length>0?$.each(e.data,function(e,t){$followstatus="1"==t[0].isFollower?"Follows you":"",null===t.u.bio&&(t.u.bio=""),$btn=user_id==t.c.follower_id?"<a href='"+BASE_URL+t.u.username+"'><button class='btn btn-info' style='width:100%;'>See Profile</button></a>":"<button class='btn btn-primary followbtn' id='follower"+t.c.follower_id+"'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button>",$newfollower="<div class='col-sm-6 col-md-6'> <div class='thumbnail'> <img src="+imgURL(t.u.username)+" alt='"+t.u.fullname+"' class='users-thumb'> <div class='caption'> <a href='"+BASE_URL+t.u.username+"' class='profile-name' id='follower-fullname'>"+t.u.fullname+"</a> <div class='profile-baseinfo'> @<span class='profile-username' id='follower-username'>"+t.u.username+"</span> <span class='follow-status'>"+$followstatus+"</span> </div> <p class='profile-bio text-justify' id='follower-bio'>"+t.u.bio+"</p> </div> "+$btn+" </div> </div>",$("#followers-tab > .row").append($newfollower),"1"==t[0].followstatus?($("#follower"+t.c.follower_id).children("#following-text").addClass("active"),$("#follower"+t.c.follower_id).children("#following-text").css("display","block")):($("#follower"+t.c.follower_id).children("#follow-text").addClass("active"),$("#follower"+t.c.follower_id).children("#follow-text").css("display","block"),$("#follower"+t.c.follower_id).removeClass("btn-primary"),$("#follower"+t.c.follower_id).addClass("btn-default"),$("#follower"+t.c.follower_id).children("#follow-text").addClass("btntext-display"))}):($msg="<p align='center' id='emptymsg'>No followers yet<p>",$("#followers-tab > .row").append($msg))):console.log("message :"+e.message)})}function getFollowing(){$.ajax({type:"POST",url:BASE_URL+"connections/fetchusers/",data:{id:visitor_id,option:1}}).done(function(e){$("#following-progress").html(""),"SUCCESS"===e.status?(console.log(e),e.data.length>0?$.each(e.data,function(e,t){$followstatus="1"==t[0].followstatus?"Follows you":"",null===t.u.bio&&(t.u.bio=""),$btn=user_id==t.c.following_id?"<a href='"+BASE_URL+t.u.username+"'><button class='btn btn-info' style='width:100%;'>See Profile</button></a>":"<button class='btn btn-primary followbtn' id='following"+t.c.following_id+"'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button>",$newfollowing=$("<div class='col-sm-6 col-md-6'> <div class='thumbnail'> <img src="+imgURL(t.u.username)+" class='users-thumb' alt='"+t.u.fullname+"'> <div class='caption'> <a href='"+BASE_URL+t.u.username+"' class='profile-name' id='follower-fullname'>"+t.u.fullname+"</a> <div class='profile-baseinfo'> @<span class='profile-username' id='follower-username'>"+t.u.username+"</span> <span class='follow-status'>"+$followstatus+"</span> </div> <p class='profile-bio text-justify' id='follower-bio'>"+t.u.bio+"</p> </div> "+$btn+" </div> </div>"),$("#following-tab > .row").append($newfollowing),"1"==t[0].isFollowing?($("#following"+t.c.following_id).children("#following-text").addClass("active"),$("#following"+t.c.following_id).children("#following-text").css("display","block")):($("#following"+t.c.following_id).children("#follow-text").addClass("active"),$("#following"+t.c.following_id).children("#follow-text").css("display","block"),$("#following"+t.c.following_id).removeClass("btn-primary"),$("#following"+t.c.following_id).addClass("btn-default"),$("#following"+t.c.following_id).children("#follow-text").addClass("btntext-display"))}):($msg="<p align='center' id='emptymsg'>Not following anyone yet<p>",$("#following-tab > .row").append($msg))):console.log("message : "+e.message)})}function removeCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}function getCookie(e){for(var t=e+"=",l=document.cookie.split(";"),o=0;o<l.length;o++){for(var s=l[o];" "===s.charAt(0);)s=s.substring(1);if(-1!==s.indexOf(t))return s.substring(t.length,s.length)}return""}function checkCookie(){var e=getCookie("user_id");(""!==e||null!==e)&&removeCookie("user_id")}function pollnewtweets(){$.ajax({url:BASE_URL+"tweet_details/poll",type:"POST",data:{type:"profile"}}).done(function(e){"NEW"===e.status&&$("#me").hasClass("active")&&($(".pollresult").html("Show "+e.message),$(".pollresult").fadeIn("slow"))})}function loadmore(){$("#progress").html("<img src='"+BASE_URL+"img/ajax-loader.gif'>"),flag===!0?(console.log("loading more"),loadTweets("bottom","profile")):($("#progress").html(""),$msg='<center><p id="emptymsg"> No more tweets to display </p></center> ',0===$("#tweet-wall").find("#emptymsg").length&&$("#tweet-wall").append($msg),stop=!0)}function saveChanges(){var e=new FormData;if(e.append("data[Upload][myimage]",$("#uploadEdit")[0].files[0]),editImgValidated===!0&&$.ajax({type:"post",url:BASE_URL+"uploads/index",data:e,contentType:!1,cache:!1,processData:!1}).done(function(e){console.log(e),console.log("SUCCESS"===e.status?e.message:e.message)}),bioEdited===!0){var t=$("#editBio").val();console.log(t),$.ajax({type:"post",url:BASE_URL+"user_details/editBio",data:{bio:t}}).done(function(e){console.log("SUCCESS"===e.status?e.message:e.message)})}}var start=0,count=25,flag=!0,stop=!1,bioEdited=!1,validated=!1,editImgValidated=!1,file=null;$(document).ready(function(){var e=localStorage.getItem("clicked");"following"===e?(localStorage.removeItem("clicked"),$(".tabbable").find('a[href="#following-tab"]').trigger("click"),getFollowing()):"followers"===e&&(localStorage.removeItem("clicked"),$(".tabbable").find('a[href="#followers-tab"]').trigger("click"),getFollowers()),$("#home").removeClass("active"),pollID=setInterval("pollnewtweets()",1e4),disable(),getuserdata(),loadTweets("initial","profile"),getSuggestions(3,null),$(window).scroll(function(){$(window).scrollTop()+$(window).height()===$(document).height()&&$("#tweets-tab").hasClass("active")&&stop!==!0&&(console.log("scroll :"+$(window).scrollTop()),loadmore())}),$(".tabbable").on({mouseenter:function(){var e=$(this).children(".active").text();console.log("active "+e),"Following"===e&&($(this).children("#following-text").css("display","none"),$(this).removeClass("btn-primary"),$(this).addClass("btn-danger"),$(this).children("#unfollow-text").addClass("btntext-display"),$(this).children("#unfollow-text").css("display","block"))},mouseleave:function(){var e=$(this).children(".active").text();console.log("active on leave: "+e),"Following"===e&&($(this).removeClass("btn-danger"),$(this).addClass("btn-primary"),$(this).children(".btntext.active").css("display","block"),$(this).children("#unfollow-text").css("display","none"),$(this).children("#unfollow-text").removeClass(".btntext-display"))}},".followbtn"),$("#tweetlink").click(function(){$(".tabbable").find('a[href="#tweets-tab"]').trigger("click")}),$("#followinglink").click(function(){$(".tabbable").find('a[href="#following-tab"]').trigger("click")}),$("#followerslink").click(function(){$(".tabbable").find('a[href="#followers-tab"]').trigger("click")}),$("[data-toggle=tooltip]").tooltip(),$("#changeAvatar").click(function(){$(this).css("display","none"),$("#uploadAvatarForm").css("display","block"),$("#uploadsubmit").attr("disabled",!0)}),$("#UploadMyimage,#uploadEdit").change(function(){console.log("binding"),file=$(this)[0].files[0];var e=validateImg(file);e===!0?"UploadMyimage"===$(this).attr("id")?($("#uploadsubmit").removeAttr("disabled"),$("#uploadsubmit").addClass("btn-success"),validated=!0):($("#saveEdits").removeAttr("disabled"),editImgValidated=!0):alert(1===e?"Invalid File Extension! Please choose valid picture file":"File is too big..Choose file having size less than 5MB")}),$("#saveEdits").click(function(){saveChanges(),$("#editClose").trigger("click")}),$("#uploadAvatarForm").on("submit",function(e){e.preventDefault(),console.log(new FormData(this)),console.log(validated),null!==file&&validated===!0&&(console.log("uploading"),$.ajax({type:"POST",url:BASE_URL+"uploads/index",data:new FormData(this),contentType:!1,cache:!1,processData:!1}).done(function(e){console.log(e),"SUCCESS"===e.status?($("#changeAvatar").css("display","block"),$("#uploadAvatarForm").css("display","none"),console.log(e.message)):console.log(e.message),location.reload(!0)}))}),$("#editProfile").on("click",function(){$.ajax({type:"GET",url:BASE_URL+"user_details/getBio"}).done(function(e){if(console.log(e),"SUCCESS"===e.status){var t=e.data[0].user_details.bio;null!==t?($("#editBio").val(t),$("#editBio").parent().siblings("#textcount").text(160-t.length)):($("#editBio").val(""),$("#editBio").parent().siblings("#textcount").text("160"))}else console.log(e.message)}),$("#editModal").modal({show:!0})}),$("#editClose").on("click",function(){$("#editForm")[0].reset(),$("#saveEdits").attr("disabled",!0),(0!=bioEdited||0!=editImgValidated)&&window.location.reload(!0)}),$(".pollresult").hover(function(){$(this).css("background-color","gainsboro")},function(){$(this).css("background-color","#f5f8fa")}),$(".pollresult").click(function(){loadTweets("top","profile")}),$("#new-tweetbtn").click(function(){console.log("Posting tweet");var e=$("#new-tweetmsg").val();$.ajax({type:"POST",url:BASE_URL+"tweet_details/posttweet",data:{tweet_text:e}}).done(function(e){if(console.log("ajax over"),"SUCCESS"===e.status){console.log(e.message),$(':input[id="new-tweetmsg"]').val(null),$("#postAlert").modal({show:!0}).delay(3e3).fadeOut(),setTimeout(function(){$(".close").trigger("click")},3e3);{new Date,e.data.tweet_id,e.data.fullname,e.data.username}pollnewtweets(),$("#emptymsg").hide(),console.log(e),tweetcount=parseInt($("#prof-tweets-count").html()),$("#prof-tweets-count").html(tweetcount+1)}else console.log(e.message),alert("Tweet couldnt be posted")})})});
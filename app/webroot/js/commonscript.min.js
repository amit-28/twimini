function hoverToggle(){$(document).on({mouseenter:function(){var e=$(this).children(".active").text();"Following"===e&&($(this).children("#following-text").css("display","none"),$(this).removeClass("btn-primary"),$(this).addClass("btn-danger"),$(this).children("#unfollow-text").addClass("btntext-display"),$(this).children("#unfollow-text").css("display","block"))},mouseleave:function(){var e=$(this).children(".active").text();"Following"===e&&($(this).removeClass("btn-danger"),$(this).addClass("btn-primary"),$(this).children(".btntext.active").css("display","block"),$(this).children("#unfollow-text").css("display","none"),$(this).children("#unfollow-text").removeClass(".btntext-display"))}},".followbtn")}function getNotifications(e,t){$.ajax({type:"POST",url:BASE_URL+"notifications/showNotifications",data:{id:user_id,start:t,type:e},cache:!1}).done(function(e){console.log(e),null!==e.data?($result="",$count=0,$(e.data).each(function(e,t){$style="";var s=t.Notification;0==s.notification_status&&($style='style="background:aliceblue"'),"like"===s.message?$result=$result+"<li class='notifyResultList pull-left' id=notification"+s.id+" "+$style+" datastatus="+s.notification_status+"><a href='/"+s.notifier_username+"'>"+s.notifier_fullname+"</a> liked your tweet</li>":"retweet"===s.message?$result=$result+"<li class='notifyResultList pull-left' id=notification"+s.id+" "+$style+" datastatus="+s.notification_status+"><a href='/"+s.notifier_username+"'>"+s.notifier_fullname+"</a> retweeted your tweet</li>":"follow"===s.message&&($result=$result+"<li class='notifyResultList pull-left' id=notification"+s.id+" "+$style+" datastatus="+s.notification_status+"><a href='/"+s.notifier_username+"'>"+s.notifier_fullname+"</a> followed you</li>")}),$(".NotifyResults").html($result),readNotifications(!0)):$(".NotifyResults").html("There are no notifications")})}function getNotificationsCount(e){$.ajax({type:"POST",url:BASE_URL+"notifications/countnotifications",data:{id:user_id,type:e},cache:!1}).done(function(e){"SUCCESS"===e.status?(console.log(e.data),"1"==e.data[0].Notification.notification_status?($(".seemore").show(),$(".seemore").html('<a href="'+BASE_URL+'notifications/">Show older</a>'),e.data.length>1?$("#noofnotifications").html(e.data[1][0].total):$(".NotifyResults").html("No new notifications")):($("#noofnotifications").html(e.data[0][0].total),$(".seemore").hide())):($(".NotifyResults").html(e.message),$(".seemore").hide())})}function readNotifications(e){var t=[];if(e)console.log($(".NotifyResults").children()),$(".NotifyResults").children().each(function(){"false"===$(this)[0].attributes.datastatus.value&&t.push(parseInt($(this)[0].id.substring(12)))}),console.log("new:"+t);else{{document.createElement("hr")}$("#notification-wall").children().each(function(){$(this).hasClass("hr")||"false"===$(this)[0].attributes.datastatus.value&&t.push(parseInt($(this)[0].id.substring(12)))}),console.log(t)}$.ajax({type:"POST",url:BASE_URL+"notifications/markreadnotifications",data:{id:user_id,readnotificationsids:t},cache:!1}).done(function(e){"SUCCESS"===e.status?(console.log("notification upadated"),getNotificationsCount("new")):console.log("notification upadate failed")})}function pollingnotification(){$.ajax({url:BASE_URL+"tweet_details/poll",type:"GET"}).done(function(e){"NEW"===e.status&&($(".pollresult").html("Show "+e.message),$(".pollresult").fadeIn("slow"))})}function searchPeople(e,t){""!==e?(console.log(t),$.ajax({type:"POST",url:BASE_URL+"user_details/search",data:{keyword:e,display:t},cache:!1}).done(function(s){$(".more").fadeOut("fast"),$(".pagemore").fadeOut("fast"),"bar"===t?(console.log(s),s.data.length>0?($result="",$(s.data).each(function(e,t){var s=t.user_details;$result=$result+"<li class='resultList'><a href='"+BASE_URL+s.username+"' class='userLink'><span class='span1'><img class='searchImg' src='"+imgURL(s.username)+"'><span class='span2'><span class='span3'><span class='span4'>"+s.fullname+"</span><span class='span5'>@"+s.username+"</span></span></span></span></a></li>"}),$(".Results").html($result),10===s.data.length&&($(".more").fadeIn(),$(".more").html('<a href="'+BASE_URL+"discover/"+e+'">See more results for "'+e+'"</a>'))):$(".Results").html("There are no results for "+e)):"page"===t&&(console.log(s),s.data.length>0?($result="",$(s.data).each(function(e,t){var s=t.user_details;$followstatus=1==t[0].isFollower&&1==t[0].followstatus?"You follow each other":1==t[0].isFollower?"Follows you":"",null===s.bio&&(s.bio=""),$result="<div class='resultList col-sm-6 col-md-6'> <div class='thumbnail'> <img src="+imgURL(s.username)+" class='users-thumb' alt='"+s.fullname+"'> <div class='caption'> <a href='"+BASE_URL+s.username+"' class='profile-name'>"+s.fullname+"</a> <div class='profile-baseinfo'> @<span class='profile-username' id='profile-username'>"+s.username+"</span><span class='follow-status'>"+$followstatus+"</span></div> <p class='profile-bio text-centered'>"+s.bio+"</p> </div> <button class='btn btn-primary followbtn' id='searchPageUser"+s.id+"'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button> </div> </div>",$("#searchPageOutput").append($result),1==t[0].followstatus?($("#searchPageUser"+s.id).children("#following-text").addClass("active"),$("#searchPageUser"+s.id).children("#following-text").css("display","block")):($("#searchPageUser"+s.id).children("#follow-text").addClass("active"),$("#searchPageUser"+s.id).children("#follow-text").css("display","block"),$("#searchPageUser"+s.id).removeClass("btn-primary"),$("#searchPageUser"+s.id).addClass("btn-default"),$("#searchPageUser"+s.id).children("#follow-text").addClass("btntext-display"))})):$("#searchPageOutput").append("There are no results for '"+e+"'"))})):$("#searchOutput").fadeOut("fast")}function fetchNext(e,t){var s=[];e.fadeOut("3000",function(){if("skipped"===t){var o=e.children().find(".suggestion-btn").attr("id");skipped[skippedindex]=parseInt(o.replace(/\D/g,"")),skippedindex+=1}e.remove(),2!==$("#suggestion-box").children().length||$("#suggestion-box").siblings().hasClass("suggestion_page")?0===$("#suggestion-box").children().length&&($msg="<p align='center'>No people to suggest<p>",$("#suggestion-box").append($msg)):($(".suggestion-btn").each(function(e){console.log(e);var t=$(this).attr("id");s[e]=parseInt(t.replace(/\D/g,""))}),console.log(s),index=s.length,$.each(skipped,function(e){console.log(skipped),s[index]=skipped[e],index+=1}),console.log(s),getSuggestions(1,s))})}function getSuggestions(e,t){$.ajax({type:"POST",url:BASE_URL+"user_details/suggest",data:{limit:e,id:t}}).done(function(t){$("#suggestion-box center").remove(),"SUCCESS"===t.status?(console.log(t),t.data.length<10&&t.data.length>0&&(flag=!1),$("#suggestion-box").children().length>0&&1!==e&&!$("#suggestion-box").siblings().hasClass("suggestion_page")&&$("#suggestion-box").children().remove(),t.data.length>0&&($.each(t.data,function(e,t){user=t.user_details,null===user.bio&&(user.bio=""),$newSuggestion=$(".suggestion_page").length>0?$("<div class='suggestion col-sm-6 col-md-6'> <div class='thumbnail'> <img src="+imgURL(user.username)+" class='users-thumb' alt='"+user.fullname+"'> <div class='caption'> <a href='"+BASE_URL+user.username+"' class='profile-name'>"+user.fullname+"</a> <div class='profile-baseinfo'> @<span class='profile-username' id='profile-username'>"+user.username+"</span></div> <p class='profile-bio text-centered'>"+user.bio+"</p> </div> <button class='btn btn-primary followbtn suggestion-btn' id='user"+user.id+"'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button> </div> </div>"):"<div class='suggestion'><div class='media'><button type='button' class='close skip'>Ã—</button><img class='media-object suggestion-pic pull-left' src='"+imgURL(user.username)+"' alt='"+user.fullname+"' <div class='media-body'><a href='"+BASE_URL+user.username+"' class='profile-name media-heading'>"+user.fullname+"</a><div class='profile-baseinfo'>@<span class='profile-username'>"+user.username+"</span></div><div class='suggestion-bio'><p class='profile-bio'>"+user.bio+"</p></div><button class='btn btn-default followbtn suggestion-btn' id='user"+user.id+"'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button></div></div></div>",$("#suggestion-box").append($newSuggestion),$("#user"+user.id).children("#follow-text").addClass("active"),$("#user"+user.id).children("#follow-text").css("display","block"),$("#user"+user.id).removeClass("btn-primary"),$("#user"+user.id).addClass("btn-default"),$("#user"+user.id).children("#follow-text").addClass("btntext-display")}),$("legend").hasClass("suggestion_page")&&(suggestion_start+=t.data.length))):(0===$("#suggestion-box").children().length&&($msg="<p align='center' id='emptymsg'>"+t.message+"<p>",$("#suggestion-box").append($msg),stop_suggestion=!0),10==e&&($("#progress").html(""),$msg='<center><p id="emptymsg"> No more suggestions to display </p></center> ',$("#progress").append($msg),stop_suggestion=!0))})}function imgURL(e){var t=BASE_URL+"img/upload/"+e+".jpg";return t}function removeCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}function getCookie(e){for(var t=e+"=",s=document.cookie.split(";"),o=0;o<s.length;o++){for(var a=s[o];" "===a.charAt(0);)a=a.substring(1);if(-1!==a.indexOf(t))return a.substring(t.length,a.length)}return""}function checkCookie(){var e=getCookie("user_id");(""!==e||null!==e)&&removeCookie("user_id")}var skipped=new Array,skippedindex=0,notificationflag=!1;$(document).ready(function(){$("#progress").html("<img src='"+BASE_URL+"img/tweets-loading.gif'>"),$("#suggestion-progress").html("<img src='"+BASE_URL+"img/tweets-loading.gif'>"),hoverToggle(),$("#SearchBar").on("keyup",function(){$("#searchOutput").fadeIn("fast"),$(".more").fadeIn(),$(".more").html("<span class='span10'>RETRIEVING RESULTS</span><img src='"+BASE_URL+"img/ajax-loader.gif' />"),searchPeople($(this).val(),"bar")}),$(document).click(function(e){var t=$(e.target);t.hasClass(".searchOutput")||($("#searchOutput").fadeOut("fast"),$("#SearchBar").val(""))}),getNotificationsCount("new"),$("#notifybell").on("click",function(){""!==$("#noofnotifications").text()?(notificationflag=!0,$("#noofnotifications").html(""),$("#notificationOutput").fadeIn("fast"),getNotifications("new",null)):(getNotificationsCount("new"),$("#notificationOutput").fadeIn("fast"))}),$(".tabbable").find('a[href="#tweets-tab"]').click(function(){pollID=setInterval("pollnewtweets()",15e3)}),$(".tabbable").find('a[href="#following-tab"]').click(function(){clearInterval(pollID),$("#following-tab > .row").children().length>0&&$("#following-tab > .row").children().remove(),userprofile.no_of_following>0?($("#following-progress").html("<img src='"+BASE_URL+"img/tweets-loading.gif'>"),getFollowing()):($msg="<p align='center' id='emptymsg'>Not following anyone yet<p>",$("#following-tab > .row").append($msg))}),$(".tabbable").find('a[href="#followers-tab"]').click(function(){clearInterval(pollID),$("#followers-tab > .row").children().length>0&&$("#followers-tab > .row").children().remove(),userprofile.no_of_followers>0?($("#followers-progress").html("<img src='"+BASE_URL+"img/tweets-loading.gif'>"),getFollowers()):($msg="<p align='center' id='emptymsg'>No followers yet<p>",$("#followers-tab > .row").append($msg))}),$(document).click(function(e){var t=$(e.target);t.hasClass(".notificationOutput")||"notifybell"===t.attr("id")||($("#notificationOutput").fadeOut("fast"),notificationflag=!1)}),$(document).bind("click",function(e){if("liketweet"===e.target.id){var t,s=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.id,o=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataorgid.value,a=e.target.parentNode.parentNode.parentNode.parentNode.attributes.datastatus.value;console.log(a),t="true"===a?e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataname.value:-1,console.log(t),console.log("tweetid: "+s),console.log("orgid: "+o),console.log("user id : "+user_id),$.ajax({type:"POST",url:BASE_URL+"likes/tweetlike",data:{userid:user_id,tweet_id:s,notified_id:o,retweeter_id:t,fullname:userprofile.fullname,username:userprofile.username}}).done(function(e){if(console.log("waiting for data"),console.log(e),"SUCCESS"===e.status){var t=s+"like";$("."+t).each(function(){var e=parseInt($(this).html())+1;$(this).html(e),console.log("curcount: "+e)});var o="likestatus"+s;$("."+o).each(function(){$(this).attr("title","Unlike"),$(this).children().removeAttr("id"),$(this).children().removeClass("glyphicon-thumbs-up"),$(this).children().attr("id","unliketweet"),$(this).children().addClass("glyphicon-thumbs-down")})}else console.log(e.message)})}if("unliketweet"===e.target.id){var t,s=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.id,o=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataorgid.value,a=e.target.parentNode.parentNode.parentNode.parentNode.attributes.datastatus.value;console.log(a),t="true"===a?e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataname.value:-1,console.log("retweeterid: "+t),console.log("tweetid: "+s),console.log("orgid: "+o),console.log("user id : "+user_id),$.ajax({type:"POST",url:BASE_URL+"likes/tweetunlike",data:{userid:user_id,tweet_id:s,notified_id:o,retweeter_id:t}}).done(function(e){if(console.log("waiting for data"),console.log(e),"SUCCESS"===e.status){var t=s+"like";$("."+t).each(function(){var e=parseInt($(this).html())-1;$(this).html(e),console.log("curcount: "+e)});var o="likestatus"+s;$("."+o).each(function(){$(this).attr("title","Like"),$(this).children().removeAttr("id"),$(this).children().removeClass("glyphicon-thumbs-down"),$(this).children().attr("id","liketweet"),$(this).children().addClass("glyphicon-thumbs-up")})}else console.log(e.message)})}if("retweet"==e.target.id){var s=e.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.id,o=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataorgid.value,a=e.target.parentNode.parentNode.parentNode.parentNode.attributes.datastatus.value;if(console.log("tweetid: "+s),console.log("orgid: "+o),console.log("rstatus: "+a),"true"===a)var t=e.target.parentNode.parentNode.parentNode.parentNode.attributes.dataname.value,l=$("."+s+"tweeterRetweeter").html().substring(13);else var t=null,l=userprofile.fullname;console.log(t),$.ajax({type:"POST",url:BASE_URL+"tweet_details/postretweet",data:{userid:user_id,tweet_id:s,orgid:o,InterID:t,fullname:l,username:userprofile.username}}).done(function(e){if(console.log("waiting for data"),console.log(e),"SUCCESS"===e.status){console.log(e);{var t=s+"tweet";new Date,$("."+s+"tweettxt").html(),$("."+s+"orgname").html(),$("."+s+"orgusername").html().substring(2)}retweetcount=$("."+t).html();var o=s+"like";if(tweetlike=$("."+o).html(),likestatus=$("#likestatus"+s).children().attr("id"),console.log(likestatus),"liketweet"===likestatus);else;pollnewtweets(),$("."+t).each(function(){var e=parseInt($(this).html())+1;$(this).html(e),console.log("curcount: "+e)})}else console.log(e.message)})}}),$(document).on("click",".followbtn",function(){var e=$(this),t=e.children(".btntext-display").text();if("Unfollow"===t){var s=$(this).attr("id");s=parseInt(s.replace(/\D/g,"")),console.log(userprofile),console.log("using"),$.ajax({type:"POST",url:BASE_URL+"connections/unfollow",data:{followerid:s}}).done(function(t){"SUCCESS"===t.status?(console.log(t.status),e.removeClass("btn-danger"),e.removeClass("btn-primary"),e.addClass("btn-default"),e.children("#follow-text").addClass("active"),e.children("#following-text").removeClass("active"),e.children("#following-text").css("display","none"),e.children("#unfollow-text").css("display","none"),e.children("#follow-text").css("display","block"),e.children("#unfollow-text").removeClass("btntext-display"),e.children("#follow-text").addClass("btntext-display")):(console.log(t.message),alert("Error in unfollow"))})}var e=$(this);if("Follow"===t){var s=$(this).attr("id");s=parseInt(s.replace(/\D/g,"")),$.ajax({type:"POST",url:BASE_URL+"connections/follow",data:{followingid:s,fullname:userprofile.fullname,username:userprofile.username}}).done(function(t){if(console.log(t),"SUCCESS"===t.status&&(e.removeClass("btn-default"),e.addClass("btn-primary"),e.children("#follow-text").removeClass("btntext-display"),e.children("#follow-text").removeClass("active"),e.children("#following-text").addClass("active"),e.children("#follow-text").css("display","none"),e.children("#following-text").css("display","block"),$("#user"+s).length>0&&(e=$("#user"+s)),e.parent().parent().hasClass("suggestion")&&fetchNext(e.parent().parent(),"followed"),userprofile.id==user_id)){var o=parseInt($("#prof-following-count").text())+1;$("#prof-following-count").text(o),userprofile.no_of_following=""+o}})}}),$(document).on("click",".skip",function(){console.log("clicked"),fetchNext($(this).parent().parent(),"skipped")}),$("#logout").click(function(){console.log("logging out"),$.ajax({type:"POST",url:BASE_URL+"user_details/logout"}).done(function(e){console.log(e),"SUCCESS"===e.status&&(checkCookie(),window.location.assign("../"))})})});
function loadTweets(e,t){$.ajax({type:"POST",url:BASE_URL+"tweet_details/retrievetweets",data:{id:user_id,start:start,count:count,display:e,type:t}}).done(function(t){if($("#progress").html(""),"FAILURE"===t.status)$("#tweet-wall").append(t.message);else{if(t.data.length<25&&t.data.length>0&&(load_flag=!1),t.data.length>0){var o="";console.log(t),$.each(t.data,function(e,t){var l=t.UD["Tweeter/Retweeter"],s=t.UD.username,a=t.T.id,i=t.T.tweet_text,n=t.T.retweetcount,r=t.T.likecount,d=new Date(t.TD.TweetTime),c=t.TD.RStatus,w=t[0]["Orginator name"],u=t[0]["Orginator username"],f=parseInt(t[0].likestatus);if(0===f)var g='<li class="actions"><button type="button" data-toggle="tooltip" title="Like" class="actionButton likestatus'+a+'"><i class="glyphicon glyphicon-thumbs-up" id="liketweet"></i></button>';else var g='<li class="actions"><button type="button" data-toggle="tooltip" title="Unlike" class="actionButton likestatus'+a+'"><i class="glyphicon glyphicon-thumbs-down" id="unliketweet"></i></button>';if(c){var p=t.TD.tweetorgid,m=t.TD.retweetorgid;o=o+'<div class="media tweetbox" id="'+a+'" style="background : aliceblue"><a class="pull-left" href="'+BASE_URL+u+'"><img class="media-object tweet-thumb" src='+imgURL(u)+' alt="Firstname Lastname">  </a><div class="media-body"> <label class="'+a+'tweeterRetweeter">Retweeted by '+l+'</label>   <h5 class="media-heading"><a href="'+BASE_URL+s+'" alt="'+w+'" class="'+a+'orgname">'+w+'</a><small class="'+a+'orgusername"> @'+u+'</small></h5>  <text class="'+a+'tweettxt">'+i+'</text><div class="tweetactions" dataorgid="'+m+'"datastatus="'+c+'" dataname="'+p+'">     <ul class="pull-right">       <li class="tweettime"><i class="glyphicon glyphicon-time" data-toggle="tooltip" title="'+d+'"></i></li> '+g+'       <span class="likecount '+a+'like" >'+r+'</span></li>        <li class="actions" ><button type="button" data-toggle="tooltip" title="Retweet" class="actionButton"><i class="glyphicon glyphicon-share-alt" id="retweet"></i></button><span class="retweetcount '+a+'tweet">'+n+"</span></li>      </ul>    </div>  </div></div>"}else{var m=t.TD.tweetorgid;o=o+'<div class="media tweetbox" id="'+a+'" style="background : aliceblue"><a class="pull-left" href="'+BASE_URL+s+'"><img class="media-object tweet-thumb" src='+imgURL(s)+' alt="'+l+'">  </a><div class="media-body">    <h5 class="media-heading"><a href="'+BASE_URL+s+'" alt="'+l+'" class="'+a+'orgname">'+l+'</a><small class="'+a+'orgusername"> @'+s+'</small></h5>  <text class="'+a+'tweettxt">'+i+'</text><div class="tweetactions" dataorgid="'+m+'" datastatus="'+c+'" >     <ul class="pull-right">       <li class="tweettime"><i class="glyphicon glyphicon-time" data-toggle="tooltip" title="'+d+'"></i></li> '+g+'       <span class="likecount '+a+'like">'+r+'</span></li>        <li class="actions" ><button type="button" data-toggle="tooltip" title="Retweet" class="actionButton" ><i class="glyphicon glyphicon-share-alt" id="retweet"></i></button><span class="retweetcount '+a+'tweet">'+n+"</span></li>      </ul>    </div>  </div></div>"}}),start+=t.data.length,"top"!==e?$("#tweet-wall").append(o):($(".pollresult").fadeOut("slow"),$(".pollresult").siblings().first().before(o).fadeIn("slow"))}else load_flag!==!1&&($msg="<p align='center' id='emptymsg'> No tweets to display </p>",$("#tweet-wall").append($msg));console.log("start: "+start)}})}function pollnewtweets(){$.ajax({url:BASE_URL+"tweet_details/poll",type:"POST",data:{type:"home"}}).done(function(e){"NEW"===e.status&&($(".pollresult").html("Show "+e.message),$(".pollresult").fadeIn("slow"))})}function getuserdata(){$.ajax({type:"POST",url:BASE_URL+"user_details/getProfile/",data:{id:user_id}}).done(function(e){console.log(e),"SUCCESS"===e.status?($profile=e.data.UserDetail,$("#prof-fullname > b").text($profile.fullname),$("#prof-fullname").attr("href",BASE_URL+$profile.username),$("#prof-username").html("@"+$profile.username),$("#prof-bio > i").html($profile.bio),$("#prof-tweets-count").text($profile.no_of_tweets),$("#prof-following-count").text($profile.no_of_following),$("#prof-followers-count").text($profile.no_of_followers),$profilepic="<img src='"+imgURL($profile.username)+"' class='img-circle'><br>",$("#changeAvatar").before($profilepic),console.log("intialing"),userprofile=$profile,$profile.resetpassword&&($("#resetPasswordModal").modal({backdrop:"static",keyboard:!1}),$("#resetPasswordModal").modal({show:!0}))):console.log(e.message)})}function getFollowers(){$.ajax({type:"POST",url:BASE_URL+"connections/fetchusers",data:{id:user_id,option:0}}).done(function(e){$("#followers-progress").html(""),"SUCCESS"===e.status?(console.log(e),$("#followers-tab > .row").children().length>0&&$("#followers-tab > .row").children().remove(),e.data.length>0?$.each(e.data,function(e,t){$followstatus=1==t[0].isFollower?"Follows you":"",null===t.u.bio&&(t.u.bio=""),$newfollower="<div class='col-sm-6 col-md-6'> <div class='thumbnail'> <img src="+imgURL(t.u.username)+" alt='"+t.u.fullname+"' class='users-thumb'> <div class='caption'> <a href='"+BASE_URL+t.u.username+"' class='profile-name' id='follower-fullname'>"+t.u.fullname+"</a> <div class='profile-baseinfo'> @<span class='profile-username' id='follower-username'>"+t.u.username+"</span> <span class='follow-status'>"+$followstatus+"</span> </div> <p class='profile-bio text-justify' id='follower-bio'>"+t.u.bio+"</p> </div> <button class='btn btn-primary followbtn' id='follower"+t.c.follower_id+"'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button> </div> </div>",$("#followers-tab > .row").append($newfollower),1==t[0].followstatus?($("#follower"+t.c.follower_id).children("#following-text").addClass("active"),$("#follower"+t.c.follower_id).children("#following-text").css("display","block")):($("#follower"+t.c.follower_id).children("#follow-text").addClass("active"),$("#follower"+t.c.follower_id).children("#follow-text").css("display","block"),$("#follower"+t.c.follower_id).removeClass("btn-primary"),$("#follower"+t.c.follower_id).addClass("btn-default"),$("#follower"+t.c.follower_id).children("#follow-text").addClass("btntext-display"))}):($msg="<p align='center' id='emptymsg'>No followers yet<p>",$("#followers-tab > .row").append($msg))):console.log("message :"+e.message)})}function getFollowing(){$.ajax({type:"POST",url:BASE_URL+"connections/fetchusers/",data:{id:user_id,option:1}}).done(function(e){$("#following-progress").html(""),"SUCCESS"===e.status?(console.log(e),$("#following-tab > .row").children().length>0&&$("#following-tab > .row").children().remove(),e.data.length>0?$.each(e.data,function(e,t){$followstatus=1==t[0].followstatus?"Follows you":"",null===t.u.bio&&(t.u.bio=""),$newfollowing=$("<div class='col-sm-6 col-md-6'> <div class='thumbnail'> <img src="+imgURL(t.u.username)+" class='users-thumb' alt='"+t.u.fullname+"'> <div class='caption'> <a href='"+BASE_URL+t.u.username+"' class='profile-name' id='follower-fullname'>"+t.u.fullname+"</a> <div class='profile-baseinfo'> @<span class='profile-username' id='follower-username'>"+t.u.username+"</span> <span class='follow-status'>"+$followstatus+"</span> </div> <p class='profile-bio text-justify' id='follower-bio'>"+t.u.bio+"</p> </div> <button class='btn btn-primary followbtn' id='following"+t.c.following_id+"'><span class='btntext' id='follow-text'>Follow</span><span class='btntext' id='following-text'>Following</span><span class='btntext' id='unfollow-text'>Unfollow</span></button> </div> </div>"),$("#following-tab > .row").append($newfollowing),1==t[0].isFollowing?($("#following"+t.c.following_id).children("#following-text").addClass("active"),$("#following"+t.c.following_id).children("#following-text").css("display","block")):($("#following"+t.c.following_id).children("#follow-text").addClass("active"),$("#following"+t.c.following_id).children("#follow-text").css("display","block"),$("#following"+t.c.following_id).removeClass("btn-primary"),$("#following"+t.c.following_id).addClass("btn-default"),$("#following"+t.c.following_id).children("#follow-text").addClass("btntext-display"))}):($msg="<p align='center' id='emptymsg'>Not following anyone yet<p>",$("#following-tab > .row").append($msg))):console.log("message : "+e.message)})}function UrlExists(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!==t.status}function validateImg(e){var t=e.name.split(".").pop().toLowerCase();return-1===$.inArray(t,["gif","png","jpg","jpeg"])?1:($file_size=e.size/1048576,$file_size>5?2:!0)}function loadmore(){$("#progress").html("<img src='"+BASE_URL+"img/ajax-loader.gif'>"),load_flag===!0?(console.log("loading more"),loadTweets("bottom","home")):($("#progress").html(""),$msg='<center><p id="emptymsg"> No more tweets to display</p></center> ',0===$("#tweet-wall").find("#emptymsg").length&&$("#tweet-wall").append($msg),stop=!0)}var start=0,count=25,userprofile=new Array,load_flag=!0,stop=!1,pollID;$(document).ready(function(){$("#uploadAvatarForm").remove(),$("#me").removeClass("active"),$("#home").addClass("active"),pollID=setInterval("pollnewtweets()",15e3),$("#changeAvatar").hide(),getuserdata(),loadTweets("initial","home"),getSuggestions(3,null),$(window).scroll(function(){$(window).scrollTop()+$(window).height()===$(document).height()&&$("#tweets-tab").hasClass("active")&&stop!==!0&&(console.log("scroll :"+$(window).scrollTop()),loadmore())}),$("[data-toggle=tooltip]").tooltip(),$("#changeAvatar").click(function(){$(this).css("display","none"),$("#uploadAvatarForm").css("display","block"),$("#uploadsubmit").attr("disabled",!0)});var e=!1,t=!1,o=!1,l=null;$("#UploadMyimage,#uploadEdit").change(function(){console.log("binding"),l=$(this)[0].files[0];var e=validateImg(l);e===!0?"UploadMyimage"===$(this).attr("id")?($("#uploadsubmit").removeAttr("disabled"),$("#uploadsubmit").addClass("btn-success"),t=!0):($("#saveEdits").removeAttr("disabled"),o=!0):alert(1===e?"Invalid File Extension! Please choose valid picture file":"File is too big..Choose file having size less than 5MB")}),$("#saveEdits").click(function(){var t=new FormData;if(t.append("data[Upload][myimage]",$("#uploadEdit")[0].files[0]),console.log(new FormData(this)),o===!0&&$.ajax({type:"post",url:BASE_URL+"uploads/index",data:t,contentType:!1,cache:!1,processData:!1}).done(function(e){console.log(e),console.log("SUCCESS"===e.status?e.message:e.message)}),e===!0){var l=$("#editBio").val();console.log(l),$.ajax({type:"post",url:BASE_URL+"user_details/editBio",data:{bio:l}}).done(function(e){console.log("SUCCESS"===e.status?e.message:e.message)})}$("#editClose").trigger("click")}),$("#uploadAvatarForm").on("submit",function(e){e.preventDefault(),console.log(new FormData(this)),console.log(t),null!==l&&t===!0&&(console.log("uploading"),$.ajax({type:"POST",url:BASE_URL+"uploads/index",data:new FormData(this),contentType:!1,cache:!1,processData:!1}).done(function(e){console.log(e),"SUCCESS"===e.status?($("#changeAvatar").css("display","block"),$("#uploadAvatarForm").css("display","none"),console.log(e.message)):console.log(e.message)}))}),$("#editProfile").on("click",function(){$.ajax({type:"GET",url:BASE_URL+"user_details/getBio"}).done(function(e){if(console.log(e),"SUCCESS"===e.status){var t=e.data[0].user_details.bio;null!==t?($("#editBio").val(t),$("#editBio").parent().siblings("#textcount").text(160-t.length)):($("#editBio").val(""),$("#editBio").parent().siblings("#textcount").text("160"))}else console.log(e.message)}),$("#editModal").modal({show:!0})}),$("#editClose").on("click",function(){$("#editForm")[0].reset(),$("#saveEdits").attr("disabled",!0)}),$("#tweetlink").click(function(){var e=$("#me_link").attr("href");window.location.href=e}),$("#followinglink").click(function(){localStorage.setItem("clicked","following");var e=$("#me_link").attr("href");window.location.href=e}),$("#followerslink").click(function(){localStorage.setItem("clicked","followers");var e=$("#me_link").attr("href");window.location.href=e}),$("#new-tweetmsg,#editBio").keyup(function(){var t=$(this).val().length;$(this).parent().siblings("#textcount").text(160-t),"editBio"===$(this).attr("id")&&(e=!0,$("#saveEdits").removeAttr("disabled"))}),$("#new-tweetbtn").click(function(){console.log("Posting tweet");var e=$("#new-tweetmsg").val();""!==e&&$.ajax({type:"POST",url:BASE_URL+"tweet_details/posttweet",data:{tweet_text:e}}).done(function(e){if(console.log("ajax over"),"SUCCESS"===e.status){console.log(e.message),$(':input[id="new-tweetmsg"]').val(null),$("#postAlert").modal({show:!0}).delay(3e3).fadeOut(),setTimeout(function(){$(".close").trigger("click")},3e3);{new Date,e.data.tweet_id,e.data.fullname,e.data.username}pollnewtweets(),$("#emptymsg").hide(),console.log(e),tweetcount=parseInt($("#prof-tweets-count").html()),$("#prof-tweets-count").html(tweetcount+1)}else console.log(e.message),alert("Tweet couldnt be posted")})});var s=!1,a=!1;$("#resetPassword").blur(function(){""===$("#resetPassword").val()&&($("#resetPasswordMissing").css({color:"red"}),$("#resetPasswordMissing").text("Enter Password"),s=!1)}),$("#resetPassword").keyup(function(){$("#resetPassword").val().length>7?($("#resetPasswordMissing").css({color:"green"}),$("#resetPasswordMissing").text("strong password"),s=!0):($("#resetPasswordMissing").css({color:"red"}),$("#resetPasswordMissing").text("cannot accept weak password"),s=!1)}),$("#resetPasswordConfirm").blur(function(){""===$("#resetPasswordConfirm").val()&&($("#resetPasswordConfirmMissing").css({color:"red"}),$("#resetPasswordConfirmMissing").text("Enter Confirm Password"),a=!0)}),$("#resetPasswordConfirm").keyup(function(){$("#resetPasswordConfirm").val()===$("#resetPassword").val()?""!==$("#resetPasswordConfirm").val()&&""!==$("#resetPassword").val()?($("#resetPasswordConfirmMissing").css({color:"green"}),$("#resetPasswordConfirmMissing").text("Password match"),a=!0):($("#resetPasswordConfirmMissing").css({color:"red"}),$("#resetPasswordConfirmMissing").text(""),a=!1):($("#resetPasswordConfirmMissing").css({color:"red"}),$("#resetPasswordConfirmMissing").text("Password mismatch"),a=!1)}),$("#savePassword").click(function(){s&&a?$.ajax({type:"POST",url:"../user_details/resetpassword",data:{password:$("#resetPassword").val()}}).done(function(e){"SUCCESS"===e.status?(a=!1,s=!1,$("#resetPasswordError").css({color:"green"}),setTimeout(function(){$("#resetPasswordModal").modal("toggle"),console.log("out")},2e3)):$("#resetPasswordError").css({color:"red"}),$("#resetPasswordError").text(e.message)}):($("#resetPasswordError").css({color:"red"}),$("#resetPasswordError").text("Please fill in above fields properly"))}),$(".pollresult").hover(function(){$(this).css("background-color","gainsboro")},function(){$(this).css("background-color","#f5f8fa")}),$(".pollresult").click(function(){loadTweets("top","home")})});